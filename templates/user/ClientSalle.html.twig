{% extends 'base2.html.twig' %}
{% block title %}
	User index
{% endblock %}
{% block body %}
	<div class="row" style="margin-top: 10px">
		<h2 style="text-align: center;">Liste des clients</h2>

		{% for user in users %}
			<div class="col-md-4">
				<div class="card mb-4 shadow-sm">
					<div
						class="row g-0">
						<!-- Adjusting avatar section size and placement -->
						<div class="col-md-5 d-flex align-items-center justify-content-center">
							{% if user.avatar %}
								<img src="{{ asset('uploads/images/' ~ user.avatar) }}" alt="Avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">
							{% endif %}
						</div>
						<div class="col-md-7">
							<div class="card-body">
								<h5 class="card-title">{{ user.nom }}
									{{ user.prenom }}</h5>
								<p class="card-text">
									<strong>Email:</strong>
									{{ user.email }}<br>
									<strong>Adresse:</strong>
									{{ user.adresse }}<br>
									<strong>Telephone:</strong>
									{{ user.num_tele }}
								</p>
							</div>
						</div>
					</div>
					<div class="card-footer bg-white">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<a class="btn btn-primary" href="{{ path('app_user_show', {'id': user.id}) }}">View</a>
								<a class="btn btn-secondary" href="{{ path('app_user_edit_Client', {'id': user.id}) }}">Edit</a>
								<a class="btn btn-dark" href="{{ path('app_user_update_password', {'id': user.id}) }}">Edit PWD</a>
								<button type="button" class="btn {{ user.is_verified ? 'btn-success' : 'btn-warning' }}" onclick="toggleVerification('{{ user.id }}', '{{ csrf_token('toggle-verification' ~ user.id) }}')">
									{{ user.is_verified ? 'Desactivate' : 'Activate' }}
								</button>
							</div>
							<button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ user.id }}">
							Delete
							
						</button>
						<div class="modal fade" id="deleteModal{{ user.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ user.id }}" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="deleteModalLabel{{ user.id }}">
											Confirm Delete
										</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<div class="modal-body">
										Are you sure you want to delete this user?
											  
									</div>
									<div class="modal-footer">
										<form method="POST" action="{{ path('app_user_delete', {'id': user.id}) }}">
											<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
													Cancel
												</button>
												<button type="submit" class="btn btn-danger">
													Delete
												</button>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% else %}
			<div class="col-12">
				<p class="text-center">No records found</p>
			</div>
		{% endfor %}

	</div>
	<script>
		function toggleVerification(userId, csrfToken) {
console.log('userID', userId);
console.log('csrfToken', csrfToken);
fetch (`/user/${userId}/toggle-verification`, {
method: 'POST',
headers: {
'Content-Type': 'application/x-www-form-urlencoded'
},
body: `_token=${csrfToken}`
}).then(response => {
if (response.ok) {
window.location.reload(); // Reload the page to reflect changes
} else {
alert('Failed to toggle verification status.');
}
}).catch(error => console.error('Error:', error));
}
	</script>
{% endblock %}
